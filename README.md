# Or-Yehuda-Weather
יצרתי את סביבת העבודה (requirements, config, venv, setx OPENWEATHER_API_KEY)
לקחתי את הlet & lon מהאתר הזה בדצימלי (כמו שרוצה בapi doc) : https://latitudelongitude.org/il/or-yehuda/ אנחנו משתמשים בגרסה החינמית בendpoint הזה: https://openweathermap.org/current
האפליקציה שלי כרגע משיגה את המעלות שבאור יהודה ואת הזמן שזה מתרחש בו (זמן מגונרט בפייתון כי הזמן שמקבלים מהapi הוא לא במילישניות)
בסוף מתברר שזה לא רלוונטי כי יש אופציה להגדיר את זה ב קיבאנה

הקמתי rabbitmq בעזרת הפקודה מהאתר שלהם :
docker run -it --rm --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:4-management

התלבטתי איך לגרום לפונקציה לרוץ כל שעה, ההתלבטות היתה איפה לממש את זה כי רוב המימושים נראים זהים
אם לממש דרך הcontainer בעזרת cron, דרך ה dockerfile בעזרת loop בbash שמחכה 3600 או בעזרת while True
cron לא מתאים כי אני רוצה שזה ירוץ כל שעה מהרגע שהרצתי ולא כל שעה עגולה
בחרתי בסוף ב while True, המימוש עם פונקציה שפשוט נקראת schedule.every(1).hours.do(job) נראה לי הכי נכון
החסרון שלי פה זה שהפוד נשאר חי שעה שלמה בלי לעשות כלום, ניסיתי ממש למצוא דרך ב docker compose שפשוט יריץ את הפוד מחדש כל שעה וימחק אותו אחר כך אבל לא מצאתי


אחרי שיצרתי docker file בשביל האפליקציה שלי הקמתי log stash בעזרת הדוקומנטציה הרשמית שלהם
בדקתי מה השימוש שלו וראיתי שהוא מקבל את המידע עושה עליו פילטורים ואז מעביר אותו למקור אחר
החלטתי שאני אתן לו לערוך את המידע שלי, grok אמור לפרק מחרוזת ולהרכיב ממנה json לפי הערכים שאני אומר לו וdate אמור לשנות את ה"ציר זמן" שהדברים האלו קרו לפי הזמן שאני הבאתי לו

לפני שהמשכתי קראתי קצת על התפקידים שלהם, es מאחסן אצלו את כל הנתונים ומאפשר שליפות מהירות ממנו לפי פילטרים ספציפים כשהמטרה היא להיות מסוגל לתמוך בכמות גדולה של מידע
זאת פעם ראשונה שאני משתמש ב elk אז החיבורים של הכלים היו קצת אתגר בשבילי ולהבין את התפקיד של כל אחד היה חשוב להמשך

אחרי זה יצרתי es, לא הצלחתי להתחבר אליו ואז אמרתי שאולי מדובר בבעית רשת כי ראיתי שהם רוצים שאני אגדיר רשת בשבילו docker network create elastic
אז החלטתי לעבור לdocker compose 
זה היה מאתגר כי לא עבדתי עם docker compose עד היום, 
הגישה שלי היתה לקחת את הdocker run שלי ופשוט להמיר את זה לdocker compose סיטקס
לבסוף זה עבד אבל עדיין הlog stash לא הצליח להתחבר
אחרי הרבה מאוד זמן הצלחתי כשאני חושב שלגשת לכתובת הנכונה ביחד עם המשתנה סביבה שמגדיר שלא יהיה אבטחה (הזדהות + ssl) היה פתרון מנצח
ההזדהות שם מוזרה מאוד, ניסיתי לפתור את זה בהתחלה אבל גם זה וגם ssl העדפתי לוותר למרות שאולי זה כן היה אפשרי
כחלק מהתהליך חשבתי שאולי זה הסדר הקמה של הservices ב docker component אז הוספתי health check לrabbitmq
החלטתי להשאיר אותו כי למה לא, שמתי לב שגם לlog stash לוקח פחות זמן לעלות מה es אבל הוא מסתדר בסוף אז החלטתי שזה בסדר
בשביל לבדוק את המידע בES http://elasticsearch:9200/_cat/indices?v=true קריאת api לזה


הקמתי grafana אבל בסוף החלטתי ללכת על kibana כדי שזה יתממשק יותר בנוחות למרות שלדעתי grafana היה עדיף
ניסיתי להשתמש ב kibana כשראיתי שהנתונים שלי מגיעים לשם והצגתי אותם שם בניטור בסיסי (קצת כמו ספלאנק)
אבל כשניסיתי להשתמש בזה ליצור עם זה גרף לא הצלחתי, רציתי ליצור גרף ואז למצוא את הקובץ שזה יוצר או ליצור קובץ כזה ולשים אותו מראש בimage
ישבתי הרבה זמן ליצור גרף ללא הצלחה  עד שבסוף ככל הנראה זה היה בעיה שאיך שהdata נשמר
שיחקתי עם זה קצת והצלחתי להגיע למצב שיש לי timestep ו temp עם מילי שניות בגרף 
עשיתי export לקובץ אבל לא לגמרי הבנתי איך משתמשים בו או איך לשים אותו ככה שזה ישתמש בו דיפולטית

ראיתי שאפשר להוסיף ווליומים מסוימים לחלק מהדברים פה אבל אני לא מכיר יותר מידי את המערכות ואז החלטתי שכל עוד זה עובד אני משאיר את זה ככה כרגע

אני לצערי לא מבין איזה ci cd אפשר להוסיף פה
אולי build וtest וpush לאפליקציה שלי 
אבל אין צורך כי ה docker compose עושה את ה build לבד בעזרת הflag --build
אולי הצורך היחיד שאני מבין זה לlinting או בדיקות וכו
הוספתי בכל מקרה env בgithub אבל לא יצרתי ci

unit test עשיתי שתיים, לבדוק שהקריאת api מחזירה מספר ולבדוק שאני לא מזוהה כשapi token לא נכון למרות שלא יתכן מצב כזה כי הוא קבוע, אולי אם הוא פג תוקף אבל זה עדיין לא בודק את המקרה הזה.
תאורטית הייתי בודק את 2 הפונקציות (api+rabbit) ועושה פעמים שהם נכשלות ועוברות
אבל זה כן מרגיש לא נכון כי זה לא לגמרי unit test, אחד תלוי ב api ובגישה לאינטרנט כשאני בכל מקרה מביא לו את אותם פרמטרים כל הזמן כלומר הפונקציה לא מקבלת פרמטרים, והשני תלוי בזה שיהיה rabbitmq למעלה.

לאן אני אמור לעשות את ה deploy?
חשבתי אולי לקוברנטיס שאני ארים אבל אז בשביל מה יש docker compose
(אני אנסה בכל זאת בזמני הפנוי)

אני לא יודע איפה אפשר להוסיף - parallel stages

כשבאתי לדחוף אז ראיתי שאני לא מצליח כי אני מחובר למשתמש github מהמייל הנוסף שלי
הלכתי ל Windows Credentials ומחקתי את הcredentials שהיה שמור
